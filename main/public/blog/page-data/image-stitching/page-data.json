{"componentChunkName":"component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js","path":"/image-stitching/","result":{"data":{"site":{"siteMetadata":{"title":"[errorcodes@DWS ~]$","social":[{"name":"Linkedin","url":"https://github.com/dwshuo"},{"name":"Github","url":"https://github.com/dwshuo"}]}},"blogPost":{"__typename":"MdxBlogPost","id":"12eb90fe-b16f-5705-974b-c7c3aa1cfedb","excerpt":"In this blog we take look at a script I wrote which determines if images are taken of\nthe same scene, and if so stitch them together to…","body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Image stitching (panoramic)\",\n  \"date\": \"2020-04-21\",\n  \"description\": \"Create a montage by identifying images taken of the same scene and viewpoint\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"In this blog we take look at a script I wrote which determines if images are taken of\\nthe same scene, and if so stitch them together to create a nice image montage/panoramic.\"), mdx(\"h2\", {\n    \"id\": \"sift-keypoint-extraction\"\n  }, \"SIFT Keypoint extraction\"), mdx(\"p\", null, \"For keypoint extraction I decided to go with SIFT(Scale-Invariant Feature Transform).\\nI found SIFT to be the easiest to understand and a great introduction to key point\\nextraction. There are of course alternatives such as SURF, BRISK and FREAK.\"), mdx(\"h3\", {\n    \"id\": \"scale-space-extrema-detection\"\n  }, \"Scale-space extrema detection\"), mdx(\"p\", null, \"Extrema points are most likely key points, and to be scale invariant we must search\\nfor stable points across multiple scales.\"), mdx(\"p\", null, \"To do this SIFT utilizes an image pyramid, where each level(octave) is derived\\nfrom applying some function to the image below.\"), mdx(\"p\", null, \"For example the following image shows a image pyramid which applies the mean function\\nat each level\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"527px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"59.42028985507246%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAAB1ElEQVQoz31RTU/UUBR9gf9g/B9uXADR4MKdK1a6YOm/8A8YowmgO1wqsTrGzEaNuJGMDCChlDCdfkxJ29evmYF03uvr+yhe2kRlRE/am/a+e9855150fhWkZJKT5ptzTikpWKGUqi4DTfdVFYSh38lOvjUJSkicxMPRSAgxVYv+plWyLEnM2WlV/56Ox1mWJmkaRXEYBEGI4ziKY5wkyeXmSkHw9Zf7bxbx8UaTy7LMtu2+1XfdAcBxXT/wS8aKophmroCXjnlxJsq8UqLOKCmElLLxqWpcCFQK/Wm1mEQH2vzu+vXd9WtH7SVeMkjiMLQdx7Ys4DfN/nGv5zhO3zQxxkhKwUoGhFDnHbaM9pL1Zdn8eD9PfjS3EkLSJIkwHg2H4DYMwW0K3oVUaJLnQRhwLlnJQdxv/bUwpcT5v4GqZkj+dvvz8uanB/q7RaMFzx2jdcv4cI/m0S9TVzTDK0q69+rG16doa3Wmu4K2V1B3dWbrMfI6j+A08E8GAy8C3TiCVXmeB+tyXSefTC6arc2HnSdo78XszhrqrqGd57PfnyHj/d2arqqXUpQAmA1jlFKIhFDwiM7iw/3XN3Vt/kBbgFHr2oKuzelvb09GvVqv+o/nnw/6haXO+GZBAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"mean pyramid\",\n    \"title\": \"mean pyramid\",\n    \"src\": \"/blog/static/5831da6164047df5f5a96a8ab512dea1/44385/mean-pyramid.png\",\n    \"srcSet\": [\"/blog/static/5831da6164047df5f5a96a8ab512dea1/e4d6b/mean-pyramid.png 345w\", \"/blog/static/5831da6164047df5f5a96a8ab512dea1/44385/mean-pyramid.png 527w\"],\n    \"sizes\": \"(max-width: 527px) 100vw, 527px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n    \")), mdx(\"p\", null, \"For SIFT at each level we apply the Difference of Gaussian kernel which is a fast\\napproximation to scale normalized Laplacian of Gaussian. After each level the\\nGaussian image is down sampled by a factor of 2 or 1/4th the orginal size. See below\\nfor illustration.\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"450px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"72.17391304347827%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIDBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAdhpUHED/8QAGhAAAgMBAQAAAAAAAAAAAAAAAQIDESISMv/aAAgBAQABBQJzRPlTmUWWXEa8r//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABkQAAIDAQAAAAAAAAAAAAAAAAABEBEhMf/aAAgBAQAGPwJaPTtiHH//xAAbEAEAAgIDAAAAAAAAAAAAAAABABEhMWGRof/aAAgBAQABPyF9HmX0Tm4aOyLT9jIXuKItz//aAAwDAQACAAMAAAAQUA//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAgEBPxAn/8QAGRABAQEBAQEAAAAAAAAAAAAAAREAIUFR/9oACAEBAAE/EJP9J3pmHGziiZnlBEWLgJnH1iSBAXGVVWhv/9k=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"sift DOG\",\n    \"title\": \"sift DOG\",\n    \"src\": \"/blog/static/c5f5b679e0f21418e9e89e06bd3eb6e6/20e5d/sift-dog.jpg\",\n    \"srcSet\": [\"/blog/static/c5f5b679e0f21418e9e89e06bd3eb6e6/8d48c/sift-dog.jpg 345w\", \"/blog/static/c5f5b679e0f21418e9e89e06bd3eb6e6/20e5d/sift-dog.jpg 450w\"],\n    \"sizes\": \"(max-width: 450px) 100vw, 450px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n    \")), mdx(\"p\", null, \"Once the Difference of Gaussian image pyramid has been computed, the pyramid is\\nsearched for local extrema over scale and space. A point is local in our case when\\ncompared with its 8-connected neighbours, 9 pixels from above and 9 pixels from below.\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"289px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"80.96885813148789%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAQABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAMEAQX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHuIfOVGh//xAAZEAACAwEAAAAAAAAAAAAAAAAAAREhIjH/2gAIAQEAAQUCLlD4lo//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAYEAACAwAAAAAAAAAAAAAAAAAAEAIhMv/aAAgBAQAGPwIuTwv/xAAaEAACAwEBAAAAAAAAAAAAAAAAAREhMWGB/9oACAEBAAE/IZppO+sTxYMUQ1IzHpimLP/aAAwDAQACAAMAAAAQ0w//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAbEAEAAgMBAQAAAAAAAAAAAAABABEhMUFRYf/aAAgBAQABPxCwCbK8MzS7wblU5V69mYBWuDsZepuQAsL8n//Z')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"sift local extrema\",\n    \"title\": \"sift local extrema\",\n    \"src\": \"/blog/static/c1dc6bc612b7a3ab0ffb618deeda6df8/b10a4/sift-local-extrema.jpg\",\n    \"srcSet\": [\"/blog/static/c1dc6bc612b7a3ab0ffb618deeda6df8/b10a4/sift-local-extrema.jpg 289w\"],\n    \"sizes\": \"(max-width: 289px) 100vw, 289px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n    \")), mdx(\"h4\", {\n    \"id\": \"keypoint-localization\"\n  }, \"Keypoint localization\"), mdx(\"p\", null, \"For each keypoint candidate position interpolation is done using Taylor expansion of\\nthe the Difference of Gaussian scale space function with the keypoint as its origin,\\nwe refer to this as D(x).\\nIf the intensity at the candidate extrema is less than the 0.03 threshold value\\nstated in the David Lowe paper, it is rejected.\"), mdx(\"p\", null, \"Difference of Gaussian often has a high response to edges. In order to increase\\nstablility, we seek to remove candidate keypoints that have poorly determined\\nlocations but high edge response. \"), mdx(\"p\", null, \"To do this a 2x2 Hessian matrix is used to compute the principal curvature of D(x).\\nThe result are two eigen values lets call them alpha and beta which are proportional\\nto the principal curvatures of D(x).\"), mdx(\"p\", null, \"Key points with poorly defined peaks in the Difference of Gaussian function have\\nlarger principal curvature across the edge than along it. Thus we can form a ratio\\nwith the alpha and beta eigen values to use as a threshold, in the paper this\\nthreshold value is defined as 10.\"), mdx(\"h4\", {\n    \"id\": \"keypoint-orientation\"\n  }, \"Keypoint orientation\"), mdx(\"p\", null, \"To achieve rotation invariance we must assign the keypoint with a orientation. We\\nfirst construct a histogram with 36 bins which covers 360 degrees around our\\nkeypoint, next we calculate the gradient magnitude and direction of the neighboring\\npixels and add them to the histogram.\"), mdx(\"p\", null, \"The orientations within 80% of the highest peaks are assigned to the keypoint. For each\\nadditional orientation assigned additional keypoints are created having the same position\\nand scale as the original keypoint.\"), mdx(\"h4\", {\n    \"id\": \"keypoint-descriptor\"\n  }, \"Keypoint descriptor\"), mdx(\"p\", null, \"Now that we have a set of keypoints that are both scale and orientation invariant.\\nWe need to generate unique \\u201Csignatures\\u201D for these keypoints. To produce this\\nsignature we take a 16x16 pixel block around the keypoint. This block is then equally\\ndivided into 4x4 sub-blocks and for each of these 4x4 sub-blocks a 8 bin oreintation\\nhistogram is creaded.\"), mdx(\"p\", null, \"In total this gives us 128 values, which is represented as a vector to form the\\nunique keypoint descriptor.\"), mdx(\"p\", null, \"The following is an illustration on how keypoint descriptor works. Note that instead\\nof a 16x16 block, the image shows a 8x8 block divided into 4x4 sub-blocks.\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"741px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"45.21739130434783%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAABlElEQVQoz02QW4+bMBSE+f//qPtY9ZLVNlm1KRsIYBvfgm3wDYwTEkjZpqp2dDRP55NmJglzrL34zckWoV2NfhJSmUZP/v5BwzWyUcloTlHTUYmzaaJeL8G92oDiKDCwJNMQdfxrlu4lfmDLsqyuLk6Oxjrjp4CDaGRjnC09S1LOckWaQR0lOijIvQKGfq/y2/yOLfd311MvTXvcH6x3+tajAgh6Yucu2dYoVWXWwEOLUgOh46WnW1YZO15irKqKE6ZvAw9d5/TJqXoUNng39tXAkx8Q5h6/CbiX5bbJ8rY+aLipMymdd+bp09O3z1/sPcKh8bfAo04tstfg5/jmcfJa13gQYtCgo4Wh3Kkmdq8UjnH633mN7WKPCxji2J7dCbOgPY9tkrd8g46FqlMJfskCdGRHy2dcPsh5ntfW3eSFaxmm2ls2SASgVt2aJWknt+PgBZU7Vr6wYoerZ1zUQf5b++9g7cWhsdFzT4LIHJYXq64OhFPyeOJcZDnM8zUDiDE+uI+al5kQwijljGGMKaXzsvwBzgXwAng5xZ8AAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"keypoint descriptor\",\n    \"title\": \"keypoint descriptor\",\n    \"src\": \"/blog/static/f1777fc33a2c13ef52b271c9dddb373b/13e20/keypoint-desc.png\",\n    \"srcSet\": [\"/blog/static/f1777fc33a2c13ef52b271c9dddb373b/e4d6b/keypoint-desc.png 345w\", \"/blog/static/f1777fc33a2c13ef52b271c9dddb373b/1e043/keypoint-desc.png 690w\", \"/blog/static/f1777fc33a2c13ef52b271c9dddb373b/13e20/keypoint-desc.png 741w\"],\n    \"sizes\": \"(max-width: 741px) 100vw, 741px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n    \")), mdx(\"h2\", {\n    \"id\": \"feature-matching-with-flann\"\n  }, \"Feature matching with FLANN\"), mdx(\"p\", null, \"Still working on this \\u2026\"));\n}\n;\nMDXContent.isMDXComponent = true;","slug":"/image-stitching/","title":"Image stitching (panoramic)","tags":[],"date":"April 21, 2020","image":null,"imageAlt":null,"socialImage":null},"previous":{"__typename":"MdxBlogPost","id":"e4a08792-7678-5d37-9a23-bb396047db1a","excerpt":"Ordinarily when a image is resized each pixel is treated equally, meaning everthing gets\nreduced or increased by the same amount. This leads…","slug":"/seam-carving/","title":"Content aware image resizing (seam carving)","date":"September 17, 2019"},"next":null},"pageContext":{"id":"12eb90fe-b16f-5705-974b-c7c3aa1cfedb","previousId":"e4a08792-7678-5d37-9a23-bb396047db1a","maxWidth":1380}},"staticQueryHashes":["2744905544","3090755652","386998304","764694655"]}
{"componentChunkName":"component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js","path":"/kernel-development-for-beginners/","result":{"data":{"site":{"siteMetadata":{"title":"[errorcodes@DWS ~]$","social":[{"name":"Linkedin","url":"https://github.com/dwshuo"},{"name":"Github","url":"https://github.com/dwshuo"}]}},"blogPost":{"__typename":"MdxBlogPost","id":"49d6b4d1-3f2c-59e1-9025-29458e60b2c5","excerpt":"The goal of this particular post is to walk you through on how to setup up your \nsystem for linux kernel development. Later on we will goâ€¦","body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Kernel development for beginners\",\n  \"date\": \"2018-10-26\",\n  \"description\": \"Beginners guide to kernel development\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"img\", {\n    \"src\": \"/blog/7b40203c5e11f8d332a809797fbecd32/menuconfig.gif\",\n    \"alt\": \"drawing\",\n    \"width\": 600\n  }), mdx(\"p\", null, \"The goal of this particular post is to walk you through on how to setup up your\\nsystem for linux kernel development. Later on we will go more in depth on topics\\nsuch as Kernel data structures, TCP implementation, and even how to write your own\\nsystem calls.\"), mdx(\"p\", null, \"Now before we start with the guide, I highly encourge you to download and use a\\nvirtual machine when playing with kernel code, for our purpose either VMware or\\nVirtualBox will do the Job. \"), mdx(\"h2\", {\n    \"id\": \"inital-setup\"\n  }, \"Inital setup\"), mdx(\"p\", null, \"In this guide we will be using the 64-bit version of Ubuntu 18.04, but any distro\\nshould be fine albeit with minor differences. Next we need to download the tarball\\ncontaining the kernel source code, you can follow this link to the download page,\\nI will be using kernel version 4.18.5 through out this guide.\"), mdx(\"p\", null, \"Next up we want to change our grub settings so that we can boot into our fancy\\ncustom kernel later on, to do this spin up a terminal and run\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"sudo vim /etc/default/grub \\n\")), mdx(\"p\", null, \"and change these two lines to read\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"GRUB_TIMEOUT = -1\\nGRUB_TIMEOUT_STYLE = menu\\n\")), mdx(\"p\", null, \"save and exit, then apply our changes by running,\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"sudo update-grub\\n\")), mdx(\"p\", null, \"Next up run \"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"sudo software-properties-gtk\\n\")), mdx(\"p\", null, \"check the box that says \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"source code\"), \", then click close. A warning will popup\\nnagging you about out of date software, we can simply ignore it and click reload.\"), mdx(\"p\", null, \"Now assuming that you saved the tarball that we previously downloaded in\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"~/Download\"), \" we run the following commands to set up our workspace.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"mkdir kernelSource\\ncd kernelSource\\nmv ~/Downloads/linux-4.18.5.tar.xz .\\ntar -xf linux-4.18.5.tar.xz\\n\")), mdx(\"p\", null, \"If you are like me and can\\u2019t remember tar flags to save your life, dont sweat my\\nfriend Arnold is here to help.\\n\", mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"734px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"96.231884057971%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAAsSAAALEgHS3X78AAACuElEQVQ4y3WUS0uqURSG/Q0O/An2F0ppHoRQTQy7UUGTKNCQQHQiDVJqYKOgIKgGFUVlmcSJMhGV0lBLyTgVFN21+/2iPbjjO+o5Zw22rrX3u9Z63732J8tkMtls9ubmZnFxMRKJbG1t7e7ubmxs+P3+YDC4vr6+t7f3/Px8fX3NMQ6/v79ncoYr+/r64mdtba21tbW9vb2qqkqr1VZWVmo0mpaWFla9Xu9wOGpra41G48jISHd3t8ViyeZMJnJcXFywsbm56Xa7JyYmPB6PyWRqaGior6/v6ekhwu7s7OzU1BS5Jicnf8DZQhO50ul0Y2Oj2WymTk1NDZ0TFD1+fn5Kh2UShijrx8cH7v7+fltbG5hUKkXzo6OjBAVbKcs/Kgtj2+l0jo+PHxwcoBwS5mOKK+fDRPFEIgFPkKenpwImdfdfsNg7Pj4eHBy02+1os7KygmB3d3d/NygrglGwr69PrVYPDAxQFpeL0Ol0TU1NNpttfn7+5eVFOizLR97f35eWlsrl8pKSEgaGCOOBTh0dHSqVSqlUKhSKpaUlSfMC8Pn5OeNRXV3NnBweHhJ8enoizpBwYQxMWVnZwsKCJF5x29Dr7+8XEavVury83NXVNTc3h4uQ+WoVgNlbXV1lQisqKrjneDze3Nw8PT1dV1fncrnC4TCyX15eMj9wKQYLGkdHR7FYbGdnB6mgh0g+n+/h4QH39vb26uqKsXl8fCyeMFaejiAp3GQy2dvby2tjVGI5oyPpzv+AkZRX0dnZKUTGqGMwGOBcXl4ejUbf3t5IzVrAWeSgn5mZGbShSfChUCgQCPAGx8bGuPbt7W2v13tyckLPnIQ5qX8qw/b19ZU/bA8PD0MY8NDQEFn4GECEayP4O2d8NkiBCj9g+qEgY8ghhKUI3wbG61fOhMtFsEKeAmdnZ0Lwb1SXrUEcrHcGAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Arnold Meme\",\n    \"title\": \"Arnold Meme\",\n    \"src\": \"/blog/static/c6ad25bb20076f1ac3f76a4681e95db2/c6d67/tar_com.png\",\n    \"srcSet\": [\"/blog/static/c6ad25bb20076f1ac3f76a4681e95db2/e4d6b/tar_com.png 345w\", \"/blog/static/c6ad25bb20076f1ac3f76a4681e95db2/1e043/tar_com.png 690w\", \"/blog/static/c6ad25bb20076f1ac3f76a4681e95db2/c6d67/tar_com.png 734w\"],\n    \"sizes\": \"(max-width: 734px) 100vw, 734px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n    \"), \"\\nNext we can delete the tarball and make two copies of the extracted files, one for\\ndevelopment and one for storing the original.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"rm linux-4.18.5.tar.xz\\nmv linux-4.18.5 linux-4.18.5-original\\ncp -r linux-4.18.5-original linux-4.18.5-dev\\n\")), mdx(\"p\", null, \"Now we need to download some extra package for our build tools\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"sudo apt-get build-dep linux-image-$(uname -r)\\n\")), mdx(\"p\", null, \"We also need to download some dependencies required for menuconfig. menuconfig is a\\nncurses based graphical tool allowing us to configure kernel settings, this is\\nhighly recommended unless you want edit the setting through a text file.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"sudo apt-get install libncurses5-dev bison pkg-config flex libelf-dev libssl-dev\\n\")), mdx(\"h2\", {\n    \"id\": \"configuring-the-kernel\"\n  }, \"Configuring the kernel\"), mdx(\"p\", null, \"Now that we have everything installed, we can configure the kernel using menuconfig,\\nbut first we need to copy our config file from boot into our development directory\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"cd linux-4.18.5-dev\\ncp /boot/config-$(uname -r) .config\\n\")), mdx(\"p\", null, \"next we need to remove the module sig key in the config file, if you are intrested in\\nwhat sig keys do, you can read about it \", mdx(\"a\", {\n    href: \"https://wiki.gentoo.org/wiki/Signed_kernel_module_support\"\n  }, \"here\"), \".\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"sudo vim .config\\n\")), mdx(\"p\", null, \"find the line that reads \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"CONFIG_MODULE_SIG_KEY =\"), \" and remove everthing behind the\\nequals sign on that line.\"), mdx(\"img\", {\n    \"src\": \"/blog/48094aa79c0d594b65285dc7cb8fc468/sig_key.gif\",\n    \"alt\": \"drawing\",\n    \"width\": 600\n  }), mdx(\"p\", null, \"One last thing before we run menuconfig, we need to streamline our config file\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"./scripts/kconfig/streamline_config.pl > ../config.streamlined\\n\")), mdx(\"p\", null, \"This little magical script allows us to cut down our kernel build time. It does this\\nby calling lsmod to find all modules running on the current system, it then reads\\nall makefiles to map which config enables which module, followed by reading the\\nKconfig files to find the dependencies and selects that may be needed to support a\\nconfig, finally it reads the config file and removes any modules that is not needed\\nto enable the currently loaded modules.\"), mdx(\"p\", null, \"now we just need to clean up a little and move our config file back to our working\\ndirectory\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"make mrproper\\ncp ../config.streamlined .config\\n\")), mdx(\"p\", null, \"To launch menuconfig run\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"make menuconfig\\n\")), mdx(\"p\", null, \"navigate with the arrow keys to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Device drivers->Graphics support->Bootup logo\"), \"\\nenable this setting with Y, save and exit. Bootup logo support is needed or else\\nwhen grub tries to use \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Plymouth/quite/splash\"), \" boot options you will get garbled\\nscreens. \"), mdx(\"img\", {\n    \"src\": \"/blog/7b40203c5e11f8d332a809797fbecd32/menuconfig.gif\",\n    \"alt\": \"drawing\",\n    \"width\": 600\n  }), mdx(\"h2\", {\n    \"id\": \"building-and-installing-the-kernel\"\n  }, \"Building and installing the kernel\"), mdx(\"p\", null, \"Lets make some changes to our kernel, compile it and then install it. For now we\\nwill do somthing easy like changing kernel EXTRAVERSION number.\"), mdx(\"p\", null, \"To do this we move to our development directory and edit our Makefile, under\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"EXTRAVERSION=\"), \" we can add our own versioning information I decided to go with my\\nname \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"EXTRAVERSION=-David\")), mdx(\"p\", null, \"Once you are satisfied with your extraversion name its time to build your kernel, run\\nthe command\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"make\\n\")), mdx(\"p\", null, \"This step could take from 20 to 40 minutes depending on your computer, so go ahead\\nand grab yourself some coffee, turn on your favorite TV show, check out some of my\\nother posts and come back in  about half an hour.\"), mdx(\"p\", null, \"Ok, hopefully it didn\\u2019t more than 30 mins, now assuming your build ran without error,\\nyou can now run\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"sudo make modules_install\\nsudo make install\\n\")), mdx(\"p\", null, \"which will create the initramfs and invoke update-grub all in one command.\"), mdx(\"p\", null, \"Congratulations!! you have now built and installed your very own kernel. Now we just\\nneed to reboot, and select the new kernel under \\u201CAdvanced Options\\u201D.\"), mdx(\"img\", {\n    \"src\": \"/blog/1bda6a7225b5742d0b7effadcd7bc3dc/demo.gif\",\n    \"alt\": \"drawing\",\n    \"width\": 600\n  }), mdx(\"p\", null, \"Once Ubuntu has been booted you can check your kernel version by typing \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"uname -r\"), \"\\ninto the terminal. you should see \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"4.18.5-David\"), \" or what ever you choose for your\\nextraversion name. \"));\n}\n;\nMDXContent.isMDXComponent = true;","slug":"/kernel-development-for-beginners/","title":"Kernel development for beginners","tags":[],"date":"October 26, 2018","image":null,"imageAlt":null,"socialImage":null},"previous":{"__typename":"MdxBlogPost","id":"cd70ba81-56c7-5284-b4de-d75c0566560f","excerpt":"Parts of speech tagging is the procces of marking up words in a given set of text \nwith their corresponding parts of speech tag, taking intoâ€¦","slug":"/parts-of-speech-tagger/","title":"Parts of speech tagger","date":"April 17, 2018"},"next":{"__typename":"MdxBlogPost","id":"8a7ef7f7-b41b-5500-b632-447d59ae8e30","excerpt":"I had two goals in mind when I set out to start this project. The first goal was to \nteach myself about android development and the secondâ€¦","slug":"/wardrobeOS/","title":"wardrobeOS","date":"October 27, 2018"}},"pageContext":{"id":"49d6b4d1-3f2c-59e1-9025-29458e60b2c5","previousId":"cd70ba81-56c7-5284-b4de-d75c0566560f","nextId":"8a7ef7f7-b41b-5500-b632-447d59ae8e30","maxWidth":1380}},"staticQueryHashes":["2744905544","3090755652","386998304","764694655"]}
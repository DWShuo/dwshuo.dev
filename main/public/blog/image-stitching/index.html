<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/blog/styles.88329ee18ac2efa18c3e.css">:root{--reach-skip-nav:1}[data-reach-skip-nav-link]{border:0;clip:rect(0 0 0 0);height:1px;width:1px;margin:-1px;padding:0;overflow:hidden;position:absolute}[data-reach-skip-nav-link]:focus{padding:1rem;position:fixed;top:10px;left:10px;background:#fff;z-index:1;width:auto;height:auto;clip:auto}body,html{margin:0}#___gatsby{font-family:sans-serif;height:100%}#gatsby-focus-wrapper{height:100%;overflow:auto}.bm-item{display:inline-block;text-decoration:none;margin-bottom:10px;color:#d1d1d1;transition:color .2s}.bm-item:hover{color:#fff}.bm-burger-button{position:fixed;width:36px;height:30px;right:30px;top:30px}.bm-burger-bars{background:#373a47}.bm-cross-button{height:24px;width:24px}.bm-cross{background:#bdc3c7}.bm-menu{background:#1a1a1a;padding:2.5em 1.5em 0;font-size:1.15em}.Header__menu__item{width:100%;background:grey;border-radius:5px;border:1px solid transparent;padding:5px 5px 5px 10px;text-decoration:none;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;font-weight:600;font-size:95%;color:#fff;margin-bottom:15px;opacity:1;transition:all .2s ease-in-out}element.style{display:block}.menuTitle{color:#fff;font-weight:800;font-size:150%;background:none;padding:0;text-align:center;margin-bottom:20px}.bm-morph-shape{fill:#373a47}.bm-item-list{color:#b8b7ad;padding:.8em}.bm-overlay{background:rgba(0,0,0,.3)}</style><meta name="generator" content="Gatsby 2.24.87"/><title data-react-helmet="true">Image stitching (panoramic) | [errorcodes@DWS ~]$</title><meta data-react-helmet="true" name="description" content="In this blog we take look at a script I wrote which determines if images are taken of
the same scene, and if so stitch them together to…"/><meta data-react-helmet="true" property="og:title" content="Image stitching (panoramic)"/><meta data-react-helmet="true" property="og:description" content="In this blog we take look at a script I wrote which determines if images are taken of
the same scene, and if so stitch them together to…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:creator" content="David S. Wang"/><meta data-react-helmet="true" name="twitter:title" content="Image stitching (panoramic)"/><meta data-react-helmet="true" name="twitter:description" content="In this blog we take look at a script I wrote which determines if images are taken of
the same scene, and if so stitch them together to…"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><link as="script" rel="preload" href="/blog/webpack-runtime-65d049c7e0bfd164af7a.js"/><link as="script" rel="preload" href="/blog/framework-dbb498007a7447f28d8e.js"/><link as="script" rel="preload" href="/blog/app-37cb779e3823baa1247d.js"/><link as="script" rel="preload" href="/blog/styles-e9d24b1846c7d6eb9685.js"/><link as="script" rel="preload" href="/blog/777cf710-b8339dbac930299739e2.js"/><link as="script" rel="preload" href="/blog/commons-d5ea4e68f42cb2f584b0.js"/><link as="script" rel="preload" href="/blog/component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js-8c8b83fd421af225f5d7.js"/><link as="fetch" rel="preload" href="/blog/page-data/image-stitching/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/blog/page-data/sq/d/2744905544.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/blog/page-data/sq/d/3090755652.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/blog/page-data/sq/d/386998304.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/blog/page-data/sq/d/764694655.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/blog/page-data/app-data.json" crossorigin="anonymous"/></head><body><script>(function() { try {
  var mode = localStorage.getItem('theme-ui-color-mode');
  if (!mode) return
  document.body.classList.add('theme-ui-' + mode);
} catch (e) {} })();</script><div id="___gatsby"><style data-emotion-css="15p9t3j">body{--theme-ui-colors-text:var(--theme-ui-colors-text,#282c35);--theme-ui-colors-background:var(--theme-ui-colors-background,#fff);--theme-ui-colors-primary:var(--theme-ui-colors-primary,#007acc);--theme-ui-colors-secondary:var(--theme-ui-colors-secondary,#1B1F23);--theme-ui-colors-muted:var(--theme-ui-colors-muted,hsla(0,0%,0%,0.2));--theme-ui-colors-highlight:var(--theme-ui-colors-highlight,rgba(255,229,100,0.2));--theme-ui-colors-heading:var(--theme-ui-colors-heading,#282c35);--theme-ui-colors-prism-background:var(--theme-ui-colors-prism-background,#011627);--theme-ui-colors-prism-comment:var(--theme-ui-colors-prism-comment,#809393);--theme-ui-colors-prism-string:var(--theme-ui-colors-prism-string,#addb67);--theme-ui-colors-prism-var:var(--theme-ui-colors-prism-var,#d6deeb);--theme-ui-colors-prism-number:var(--theme-ui-colors-prism-number,#f78c6c);--theme-ui-colors-prism-constant:var(--theme-ui-colors-prism-constant,#82aaff);--theme-ui-colors-prism-punctuation:var(--theme-ui-colors-prism-punctuation,#c792ea);--theme-ui-colors-prism-className:var(--theme-ui-colors-prism-className,#ffc98b);--theme-ui-colors-prism-tag:var(--theme-ui-colors-prism-tag,#ffa7c4);--theme-ui-colors-prism-boolean:var(--theme-ui-colors-prism-boolean,#ff5874);--theme-ui-colors-prism-property:var(--theme-ui-colors-prism-property,#80cbc4);--theme-ui-colors-prism-namespace:var(--theme-ui-colors-prism-namespace,#b2ccd6);--theme-ui-colors-prism-highlight:var(--theme-ui-colors-prism-highlight,hsla(207,95%,15%,1));color:var(--theme-ui-colors-text,#282c35);background-color:var(--theme-ui-colors-background,#fff);}body.theme-ui-dark{--theme-ui-colors-text:var(--theme-ui-colors-modes-dark-text,rgba(255,255,255,0.86));--theme-ui-colors-background:var(--theme-ui-colors-modes-dark-background,#232129);--theme-ui-colors-primary:var(--theme-ui-colors-modes-dark-primary,#D9BAE8);--theme-ui-colors-secondary:var(--theme-ui-colors-modes-dark-secondary,rgba(255,255,255,0.86));--theme-ui-colors-muted:var(--theme-ui-colors-modes-dark-muted,hsla(0,0%,100%,0.2));--theme-ui-colors-highlight:var(--theme-ui-colors-modes-dark-highlight,#663399);--theme-ui-colors-heading:var(--theme-ui-colors-modes-dark-heading,#fff);}</style><style data-emotion-css="8ir1vi">*{box-sizing:border-box;}body{margin:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",sans-serif;}</style><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion-css="ocpejr">.css-ocpejr{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",sans-serif;}</style><div class="css-ocpejr"><div id="page-wrap"><div><div class="bm-overlay" style="position:fixed;z-index:1000;width:100%;height:100%;background:rgba(0, 0, 0, 0.3);opacity:0;-moz-transform:translate3d(100%, 0, 0);-ms-transform:translate3d(100%, 0, 0);-o-transform:translate3d(100%, 0, 0);-webkit-transform:translate3d(100%, 0, 0);transform:translate3d(100%, 0, 0);transition:opacity 0.3s, transform 0s 0.3s"></div><div><div class="bm-burger-button" style="z-index:1000"><button id="react-burger-menu-btn" style="position:absolute;left:0;top:0;z-index:1;width:100%;height:100%;margin:0;padding:0;border:none;font-size:0;background:transparent;cursor:pointer">Open Menu</button><span><span class="bm-burger-bars" style="position:absolute;height:20%;left:0;right:0;top:0%;opacity:1"></span><span class="bm-burger-bars" style="position:absolute;height:20%;left:0;right:0;top:40%;opacity:1"></span><span class="bm-burger-bars" style="position:absolute;height:20%;left:0;right:0;top:80%;opacity:1"></span></span></div></div><div id="push" class="bm-menu-wrap" style="position:fixed;right:0;z-index:1100;width:300px;height:100%;-moz-transform:translate3d(100%, 0, 0);-ms-transform:translate3d(100%, 0, 0);-o-transform:translate3d(100%, 0, 0);-webkit-transform:translate3d(100%, 0, 0);transform:translate3d(100%, 0, 0);transition:all 0.5s" aria-hidden="true"><div class="bm-menu" style="height:100%;box-sizing:border-box;overflow:auto"><nav class="bm-item-list" style="height:100%"><a aria-current="page" class="bm-item bm-item Header__menu__item menuTitle" style="display:block" tabindex="0" href="/" tabindex="-1">DWS</a><a class="bm-item menu-item Header__menu__item" href="/" style="display:block" tabindex="-1"> Home </a><a class="bm-item menu-item Header__menu__item" href="/blog" style="display:block" tabindex="-1"> Blog </a><a class="bm-item menu-item Header__menu__item" href="/resume.pdf" style="display:block" tabindex="-1"> Resume </a><a class="bm-item menu-item Header__menu__item" href="https://github.com/DWShuo" style="display:block" tabindex="-1"> Github </a></nav></div><div><div class="bm-cross-button" style="position:absolute;width:24px;height:24px;right:8px;top:8px"><button id="react-burger-cross-btn" style="position:absolute;left:0;top:0;z-index:1;width:100%;height:100%;margin:0;padding:0;border:none;font-size:0;background:transparent;cursor:pointer" tabindex="-1">Close Menu</button><span style="position:absolute;top:6px;right:14px"><span class="bm-cross" style="position:absolute;width:3px;height:14px;transform:rotate(45deg)"></span><span class="bm-cross" style="position:absolute;width:3px;height:14px;transform:rotate(-45deg)"></span></span></div></div></div></div><header><style data-emotion-css="o7eq5i">.css-o7eq5i{color:var(--theme-ui-colors-primary,#007acc);}</style><a class="css-o7eq5i" href="#reach-skip-nav" data-reach-skip-link="" data-reach-skip-nav-link="">Skip to content</a><style data-emotion-css="1ufxd81">.css-1ufxd81{max-width:672px;margin-left:auto;margin-right:auto;padding-left:16px;padding-right:16px;padding-top:32px;}</style><div class="css-1ufxd81"><style data-emotion-css="4c94nt">.css-4c94nt{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-bottom:32px;}</style><div class="css-4c94nt"><style data-emotion-css="1qd1r5f">.css-1qd1r5f{margin-top:0;margin-bottom:0;}</style><p class="css-1qd1r5f"><style data-emotion-css="1febbns">.css-1febbns{box-shadow:none;-webkit-text-decoration:none;text-decoration:none;color:var(--theme-ui-colors-primary,#007acc);}</style><style data-emotion-css="1a7e4c0">.css-1a7e4c0{color:var(--theme-ui-colors-primary,#007acc);box-shadow:none;-webkit-text-decoration:none;text-decoration:none;color:var(--theme-ui-colors-primary,#007acc);}</style><a class="css-1a7e4c0" href="/blog/">[errorcodes@DWS ~]$</a></p></div></div></header></div><div id="reach-skip-nav" data-reach-skip-nav-content=""></div><div><style data-emotion-css="1in33uw">.css-1in33uw{max-width:672px;margin-left:auto;margin-right:auto;padding-left:16px;padding-right:16px;padding-top:32px;padding-bottom:32px;}</style><div class="css-1in33uw"><main><article><header><h1 class="css-0">Image stitching (panoramic)</h1><style data-emotion-css="1h1xv8c">.css-1h1xv8c{font-size:14px;margin-top:-16px;margin-bottom:16px;}</style><style data-emotion-css="dv5tmu">.css-dv5tmu{font-size:14px;margin-top:-16px;margin-bottom:16px;}.css-dv5tmu code{font-size:inherit;}</style><p class="css-dv5tmu">April 21, 2020</p></header><section><style data-emotion-css="1ek8oqb">.css-1ek8oqb code{font-size:inherit;}</style><p class="css-1ek8oqb">In this blog we take look at a script I wrote which determines if images are taken of
the same scene, and if so stitch them together to create a nice image montage/panoramic.</p><style data-emotion-css="h7w91b">.css-h7w91b{pointer-events:painted;}.css-h7w91b a{visibility:hidden;}.css-h7w91b:hover a{visibility:visible;}</style><h2 id="sift-keypoint-extraction" class="css-h7w91b"><style data-emotion-css="vvm4x1">.css-vvm4x1{margin-left:-20px;padding-right:4px;color:var(--theme-ui-colors-primary,#007acc);}</style><a href="#sift-keypoint-extraction" aria-label="SIFT Keypoint extraction" class="css-vvm4x1"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>SIFT Keypoint extraction</h2><p class="css-1ek8oqb">For keypoint extraction I decided to go with SIFT(Scale-Invariant Feature Transform).
I found SIFT to be the easiest to understand and a great introduction to key point
extraction. There are of course alternatives such as SURF, BRISK and FREAK.</p><h3 id="scale-space-extrema-detection" class="css-h7w91b"><a href="#scale-space-extrema-detection" aria-label="Scale-space extrema detection" class="css-vvm4x1"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Scale-space extrema detection</h3><p class="css-1ek8oqb">Extrema points are most likely key points, and to be scale invariant we must search
for stable points across multiple scales.</p><p class="css-1ek8oqb">To do this SIFT utilizes an image pyramid, where each level(octave) is derived
from applying some function to the image below.</p><p class="css-1ek8oqb">For example the following image shows a image pyramid which applies the mean function
at each level</p><p class="css-1ek8oqb"><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:527px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:59.42028985507246%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAAB1ElEQVQoz31RTU/UUBR9gf9g/B9uXADR4MKdK1a6YOm/8A8YowmgO1wqsTrGzEaNuJGMDCChlDCdfkxJ29evmYF03uvr+yhe2kRlRE/am/a+e9855150fhWkZJKT5ptzTikpWKGUqi4DTfdVFYSh38lOvjUJSkicxMPRSAgxVYv+plWyLEnM2WlV/56Ox1mWJmkaRXEYBEGI4ziKY5wkyeXmSkHw9Zf7bxbx8UaTy7LMtu2+1XfdAcBxXT/wS8aKophmroCXjnlxJsq8UqLOKCmElLLxqWpcCFQK/Wm1mEQH2vzu+vXd9WtH7SVeMkjiMLQdx7Ys4DfN/nGv5zhO3zQxxkhKwUoGhFDnHbaM9pL1Zdn8eD9PfjS3EkLSJIkwHg2H4DYMwW0K3oVUaJLnQRhwLlnJQdxv/bUwpcT5v4GqZkj+dvvz8uanB/q7RaMFzx2jdcv4cI/m0S9TVzTDK0q69+rG16doa3Wmu4K2V1B3dWbrMfI6j+A08E8GAy8C3TiCVXmeB+tyXSefTC6arc2HnSdo78XszhrqrqGd57PfnyHj/d2arqqXUpQAmA1jlFKIhFDwiM7iw/3XN3Vt/kBbgFHr2oKuzelvb09GvVqv+o/nnw/6haXO+GZBAAAAAElFTkSuQmCC&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image css-0" alt="mean pyramid" title="mean pyramid" src="/blog/static/5831da6164047df5f5a96a8ab512dea1/44385/mean-pyramid.png" srcSet="/blog/static/5831da6164047df5f5a96a8ab512dea1/e4d6b/mean-pyramid.png 345w,/blog/static/5831da6164047df5f5a96a8ab512dea1/44385/mean-pyramid.png 527w" sizes="(max-width: 527px) 100vw, 527px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
    </span></p><p class="css-1ek8oqb">For SIFT at each level we apply the Difference of Gaussian kernel which is a fast
approximation to scale normalized Laplacian of Gaussian. After each level the
Gaussian image is down sampled by a factor of 2 or 1/4th the orginal size. See below
for illustration.</p><p class="css-1ek8oqb"><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:450px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:72.17391304347827%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIDBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAdhpUHED/8QAGhAAAgMBAQAAAAAAAAAAAAAAAQIDESISMv/aAAgBAQABBQJzRPlTmUWWXEa8r//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABkQAAIDAQAAAAAAAAAAAAAAAAABEBEhMf/aAAgBAQAGPwJaPTtiHH//xAAbEAEAAgIDAAAAAAAAAAAAAAABABEhMWGRof/aAAgBAQABPyF9HmX0Tm4aOyLT9jIXuKItz//aAAwDAQACAAMAAAAQUA//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAgEBPxAn/8QAGRABAQEBAQEAAAAAAAAAAAAAAREAIUFR/9oACAEBAAE/EJP9J3pmHGziiZnlBEWLgJnH1iSBAXGVVWhv/9k=&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image css-0" alt="sift DOG" title="sift DOG" src="/blog/static/c5f5b679e0f21418e9e89e06bd3eb6e6/20e5d/sift-dog.jpg" srcSet="/blog/static/c5f5b679e0f21418e9e89e06bd3eb6e6/8d48c/sift-dog.jpg 345w,/blog/static/c5f5b679e0f21418e9e89e06bd3eb6e6/20e5d/sift-dog.jpg 450w" sizes="(max-width: 450px) 100vw, 450px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
    </span></p><p class="css-1ek8oqb">Once the Difference of Gaussian image pyramid has been computed, the pyramid is
searched for local extrema over scale and space. A point is local in our case when
compared with its 8-connected neighbours, 9 pixels from above and 9 pixels from below.</p><p class="css-1ek8oqb"><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:289px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:80.96885813148789%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAQABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAMEAQX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHuIfOVGh//xAAZEAACAwEAAAAAAAAAAAAAAAAAAREhIjH/2gAIAQEAAQUCLlD4lo//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAYEAACAwAAAAAAAAAAAAAAAAAAEAIhMv/aAAgBAQAGPwIuTwv/xAAaEAACAwEBAAAAAAAAAAAAAAAAAREhMWGB/9oACAEBAAE/IZppO+sTxYMUQ1IzHpimLP/aAAwDAQACAAMAAAAQ0w//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAbEAEAAgMBAQAAAAAAAAAAAAABABEhMUFRYf/aAAgBAQABPxCwCbK8MzS7wblU5V69mYBWuDsZepuQAsL8n//Z&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image css-0" alt="sift local extrema" title="sift local extrema" src="/blog/static/c1dc6bc612b7a3ab0ffb618deeda6df8/b10a4/sift-local-extrema.jpg" srcSet="/blog/static/c1dc6bc612b7a3ab0ffb618deeda6df8/b10a4/sift-local-extrema.jpg 289w" sizes="(max-width: 289px) 100vw, 289px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
    </span></p><h4 id="keypoint-localization" class="css-h7w91b"><a href="#keypoint-localization" aria-label="Keypoint localization" class="css-vvm4x1"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Keypoint localization</h4><p class="css-1ek8oqb">For each keypoint candidate position, interpolation is done using the taylor expansion of
the Difference of Gaussian function with the keypoint as its origin, we refer to this as D(x).
If the intensity at the candidate extrema is less than the 0.03 threshold value
stated in the David Lowe paper, it is rejected.</p><p class="css-1ek8oqb">Difference of Gaussian often has a high response to edges. In order to increase
stablility, we seek to remove candidate keypoints that have poorly determined
locations but high edge response. </p><p class="css-1ek8oqb">To do this a 2x2 Hessian matrix is used to compute the principal curvature of D(x).
The result are two eigen values lets call them alpha and beta which are proportional
to the principal curvatures of D(x).</p><p class="css-1ek8oqb">Key points with poorly defined peaks in the Difference of Gaussian function have
larger principal curvature across the edge than along it. Thus we can form a ratio
with the alpha and beta eigen values to use as a threshold, in the paper this
threshold value is defined as 10.</p><h4 id="keypoint-orientation" class="css-h7w91b"><a href="#keypoint-orientation" aria-label="Keypoint orientation" class="css-vvm4x1"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Keypoint orientation</h4><p class="css-1ek8oqb">To achieve rotation invariance we must assign the keypoint with a orientation. We
first construct a histogram with 36 bins which covers 360 degrees around our
keypoint, next we calculate the gradient magnitude and direction of the neighboring
pixels(8-connected) and add them to the histogram.</p><p class="css-1ek8oqb">The orientations within 80% of the highest peaks are assigned to the keypoint. For each
additional orientation assigned, new keypoints are created having the same position
and scale as the original keypoint.</p><h4 id="keypoint-descriptor" class="css-h7w91b"><a href="#keypoint-descriptor" aria-label="Keypoint descriptor" class="css-vvm4x1"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Keypoint descriptor</h4><p class="css-1ek8oqb">Now that we have a set of keypoints that are both scale and orientation invariant.
We need to generate unique “signatures” for these keypoints. To produce this
signature we take a 16x16 pixel block around the keypoint. This block is then equally
divided into 4x4 sub-blocks and for each of these 4x4 sub-blocks a 8 bin orientation
histogram is created.</p><p class="css-1ek8oqb">In total this gives us 128 values, which is represented as a vector to form the
unique keypoint descriptor.</p><p class="css-1ek8oqb">The following is an illustration on how keypoint descriptor works. Note that instead
of a 16x16 block, the image shows a zoomed in 8x8 block divided into 4x4 sub-blocks.</p><p class="css-1ek8oqb"><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:741px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:45.21739130434783%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAABlElEQVQoz02QW4+bMBSE+f//qPtY9ZLVNlm1KRsIYBvfgm3wDYwTEkjZpqp2dDRP55NmJglzrL34zckWoV2NfhJSmUZP/v5BwzWyUcloTlHTUYmzaaJeL8G92oDiKDCwJNMQdfxrlu4lfmDLsqyuLk6Oxjrjp4CDaGRjnC09S1LOckWaQR0lOijIvQKGfq/y2/yOLfd311MvTXvcH6x3+tajAgh6Yucu2dYoVWXWwEOLUgOh46WnW1YZO15irKqKE6ZvAw9d5/TJqXoUNng39tXAkx8Q5h6/CbiX5bbJ8rY+aLipMymdd+bp09O3z1/sPcKh8bfAo04tstfg5/jmcfJa13gQYtCgo4Wh3Kkmdq8UjnH633mN7WKPCxji2J7dCbOgPY9tkrd8g46FqlMJfskCdGRHy2dcPsh5ntfW3eSFaxmm2ls2SASgVt2aJWknt+PgBZU7Vr6wYoerZ1zUQf5b++9g7cWhsdFzT4LIHJYXq64OhFPyeOJcZDnM8zUDiDE+uI+al5kQwijljGGMKaXzsvwBzgXwAng5xZ8AAAAASUVORK5CYII=&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image css-0" alt="keypoint descriptor" title="keypoint descriptor" src="/blog/static/f1777fc33a2c13ef52b271c9dddb373b/13e20/keypoint-desc.png" srcSet="/blog/static/f1777fc33a2c13ef52b271c9dddb373b/e4d6b/keypoint-desc.png 345w,/blog/static/f1777fc33a2c13ef52b271c9dddb373b/1e043/keypoint-desc.png 690w,/blog/static/f1777fc33a2c13ef52b271c9dddb373b/13e20/keypoint-desc.png 741w" sizes="(max-width: 741px) 100vw, 741px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
    </span></p><h2 id="feature-matching-with-flann" class="css-h7w91b"><a href="#feature-matching-with-flann" aria-label="Feature matching with FLANN" class="css-vvm4x1"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Feature matching with FLANN</h2><p class="css-1ek8oqb">There are two common methods for feature matching, brute force matching and FLANN.</p><p class="css-1ek8oqb">Brute force matching performs an exhaustive search and guarantees the best match,
but this comes at the cost of being extremely slow.</p><p class="css-1ek8oqb">FLANN or “Fast Library for Approximate Nearest Neighbors” is much faster but does
not gaurntee the best match,but instead provides the approximate best match.
To achive its speed FLANN stores the key points in a <a href="https://en.wikipedia.org/wiki/K-d_tree" class="css-o7eq5i">k-d tree</a>,
which is a special cases of a binary space partitioning trees. Once all the key
points are inserted into the k-d tree, k-nearest neighbors algorithm is ran with k set to 2.</p><p class="css-1ek8oqb">This returns the best match and second best match, their similarities are then
compared via a ratio test. If the result is a high ratio this would suggest that the
best match is not unique and maybe a part of a repeated pattern, thus we should
discard the pair. If on the other hand we obtain a pair with a ratio that falls
within our threshold this would suggest that the best match is unique.</p><h2 id="code-keypoint-matching" class="css-h7w91b"><a href="#code-keypoint-matching" aria-label="CODE: keypoint matching" class="css-vvm4x1"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CODE: keypoint matching</h2><style data-emotion-css="f4r2wo">.css-f4r2wo{font-family:Menlo,monospace;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;margin-bottom:8px;color:white;background-color:var(--theme-ui-colors-prism-background,#011627);overflow:auto;border-radius:10px;padding:16px;}.css-f4r2wo .attr-name{font-style:italic;}.css-f4r2wo .comment{color:var(--theme-ui-colors-prism-comment,#809393);}.css-f4r2wo .attr-name,.css-f4r2wo .string,.css-f4r2wo .url{color:var(--theme-ui-colors-prism-string,#addb67);}.css-f4r2wo .variable{color:var(--theme-ui-colors-prism-var,#d6deeb);}.css-f4r2wo .number{color:var(--theme-ui-colors-prism-number,#f78c6c);}.css-f4r2wo .builtin,.css-f4r2wo .char,.css-f4r2wo .constant,.css-f4r2wo .function{color:var(--theme-ui-colors-prism-constant,#82aaff);}.css-f4r2wo .punctuation,.css-f4r2wo .selector,.css-f4r2wo .doctype{color:var(--theme-ui-colors-prism-punctuation,#c792ea);}.css-f4r2wo .class-name{color:var(--theme-ui-colors-prism-className,#ffc98b);}.css-f4r2wo .tag,.css-f4r2wo .operator,.css-f4r2wo .keyword{color:var(--theme-ui-colors-prism-tag,#ffa7c4);}.css-f4r2wo .boolean{color:var(--theme-ui-colors-prism-boolean,#ff5874);}.css-f4r2wo .property{color:var(--theme-ui-colors-prism-property,#80cbc4);}.css-f4r2wo .namespace{color:var(--theme-ui-colors-prism-namespace,#b2ccd6);}.css-f4r2wo .highlight{background:hsla(0,0%,40%,.5);}</style><style data-emotion-css="1q7q4hh">.css-1q7q4hh{font-family:Menlo,monospace;font-size:inherit;}</style><style data-emotion-css="1eu4vb7">.css-1eu4vb7{font-family:Menlo,monospace;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;margin-bottom:8px;color:white;background-color:var(--theme-ui-colors-prism-background,#011627);overflow:auto;border-radius:10px;padding:16px;font-family:Menlo,monospace;font-size:inherit;}.css-1eu4vb7 .attr-name{font-style:italic;}.css-1eu4vb7 .comment{color:var(--theme-ui-colors-prism-comment,#809393);}.css-1eu4vb7 .attr-name,.css-1eu4vb7 .string,.css-1eu4vb7 .url{color:var(--theme-ui-colors-prism-string,#addb67);}.css-1eu4vb7 .variable{color:var(--theme-ui-colors-prism-var,#d6deeb);}.css-1eu4vb7 .number{color:var(--theme-ui-colors-prism-number,#f78c6c);}.css-1eu4vb7 .builtin,.css-1eu4vb7 .char,.css-1eu4vb7 .constant,.css-1eu4vb7 .function{color:var(--theme-ui-colors-prism-constant,#82aaff);}.css-1eu4vb7 .punctuation,.css-1eu4vb7 .selector,.css-1eu4vb7 .doctype{color:var(--theme-ui-colors-prism-punctuation,#c792ea);}.css-1eu4vb7 .class-name{color:var(--theme-ui-colors-prism-className,#ffc98b);}.css-1eu4vb7 .tag,.css-1eu4vb7 .operator,.css-1eu4vb7 .keyword{color:var(--theme-ui-colors-prism-tag,#ffa7c4);}.css-1eu4vb7 .boolean{color:var(--theme-ui-colors-prism-boolean,#ff5874);}.css-1eu4vb7 .property{color:var(--theme-ui-colors-prism-property,#80cbc4);}.css-1eu4vb7 .namespace{color:var(--theme-ui-colors-prism-namespace,#b2ccd6);}.css-1eu4vb7 .highlight{background:hsla(0,0%,40%,.5);}</style><pre class="language-python prism-code language-python css-1eu4vb7"><div class="token-line"><span class="token comment">#SIFT(read note on SIFT patent)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">sift </span><span class="token operator">=</span><span class="token plain"> cv2</span><span class="token punctuation">.</span><span class="token plain">xfeatures2d</span><span class="token punctuation">.</span><span class="token plain">SIFT_create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">kpt1</span><span class="token punctuation">,</span><span class="token plain"> des1 </span><span class="token operator">=</span><span class="token plain"> sift</span><span class="token punctuation">.</span><span class="token plain">detectAndCompute</span><span class="token punctuation">(</span><span class="token plain">img1</span><span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">kpt2</span><span class="token punctuation">,</span><span class="token plain"> des2 </span><span class="token operator">=</span><span class="token plain"> sift</span><span class="token punctuation">.</span><span class="token plain">detectAndCompute</span><span class="token punctuation">(</span><span class="token plain">img2</span><span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">#FLANN key point matching</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">FLANN_INDEX_KDTREE </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">index_params </span><span class="token operator">=</span><span class="token plain"> </span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token plain">algorithm </span><span class="token operator">=</span><span class="token plain"> FLANN_INDEX_KDTREE</span><span class="token punctuation">,</span><span class="token plain"> trees </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">search_params </span><span class="token operator">=</span><span class="token plain"> </span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token plain">checks </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">50</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">flann </span><span class="token operator">=</span><span class="token plain"> cv2</span><span class="token punctuation">.</span><span class="token plain">FlannBasedMatcher</span><span class="token punctuation">(</span><span class="token plain">index_params</span><span class="token punctuation">,</span><span class="token plain"> search_params</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">matches </span><span class="token operator">=</span><span class="token plain"> flann</span><span class="token punctuation">.</span><span class="token plain">knnMatch</span><span class="token punctuation">(</span><span class="token plain">des1</span><span class="token punctuation">,</span><span class="token plain"> des2</span><span class="token punctuation">,</span><span class="token plain"> k </span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">#Finding good matches</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">good </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">pts1 </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">pts2 </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">for</span><span class="token plain"> i</span><span class="token punctuation">,</span><span class="token plain"> j </span><span class="token keyword">in</span><span class="token plain"> matches</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> i</span><span class="token punctuation">.</span><span class="token plain">distance </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">0.8</span><span class="token operator">*</span><span class="token plain">j</span><span class="token punctuation">.</span><span class="token plain">distance</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        good</span><span class="token punctuation">.</span><span class="token plain">append</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token plain">i</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        pts2</span><span class="token punctuation">.</span><span class="token plain">append</span><span class="token punctuation">(</span><span class="token plain">kpt2</span><span class="token punctuation">[</span><span class="token plain">i</span><span class="token punctuation">.</span><span class="token plain">trainIdx</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token plain">pt</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        pts1</span><span class="token punctuation">.</span><span class="token plain">append</span><span class="token punctuation">(</span><span class="token plain">kpt1</span><span class="token punctuation">[</span><span class="token plain">i</span><span class="token punctuation">.</span><span class="token plain">queryIdx</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token plain">pt</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">#Return image with matched keypoints highlighted</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">good </span><span class="token operator">=</span><span class="token plain"> np</span><span class="token punctuation">.</span><span class="token plain">array</span><span class="token punctuation">(</span><span class="token plain">good</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">pts1 </span><span class="token operator">=</span><span class="token plain"> np</span><span class="token punctuation">.</span><span class="token plain">array</span><span class="token punctuation">(</span><span class="token plain">pts1</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">pts2 </span><span class="token operator">=</span><span class="token plain"> np</span><span class="token punctuation">.</span><span class="token plain">array</span><span class="token punctuation">(</span><span class="token plain">pts2</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#x27;Matches found: %d&#x27;</span><span class="token operator">%</span><span class="token punctuation">(</span><span class="token plain">good</span><span class="token punctuation">.</span><span class="token plain">shape</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">out </span><span class="token operator">=</span><span class="token plain"> cv2</span><span class="token punctuation">.</span><span class="token plain">drawMatchesKnn</span><span class="token punctuation">(</span><span class="token plain">img1</span><span class="token punctuation">,</span><span class="token plain"> kpt1</span><span class="token punctuation">,</span><span class="token plain"> img2</span><span class="token punctuation">,</span><span class="token plain"> kpt2</span><span class="token punctuation">,</span><span class="token plain"> good</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation">,</span><span class="token plain"> flags </span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">cv2</span><span class="token punctuation">.</span><span class="token plain">imwrite</span><span class="token punctuation">(</span><span class="token plain">img_out</span><span class="token operator">+</span><span class="token string">&quot;_match_init.jpg&quot;</span><span class="token punctuation">,</span><span class="token plain"> out</span><span class="token punctuation">)</span></div></pre><h3 id="note-on-sift-patent" class="css-h7w91b"><a href="#note-on-sift-patent" aria-label="Note on SIFT patent" class="css-vvm4x1"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Note on SIFT patent</h3><p class="css-1ek8oqb">Since OpenCV 3.4.3 SIFT and SURF algorithms have been moved behind a
<style data-emotion-css="1pnz7gf">.css-1pnz7gf{border-radius:0.3em;color:var(--theme-ui-colors-secondary,#1B1F23);background-color:var(--theme-ui-colors-highlight,rgba(255,229,100,0.2));padding-top:0.15em;padding-bottom:0.05em;padding-left:0.2em;padding-right:0.2em;}</style><code class="css-1pnz7gf">OPENCV_ENABLE_NONFRE</code> flag. This is due to SIFT being patented and thus cannot
be legally distributed under OpenCV’s MIT license.</p><p class="css-1ek8oqb">There are two workarounds for this. One is to roll back to a version before this
change was pushed out. Second solution is to compile OpenCV yourself with the
<code class="css-1pnz7gf">OPENCV_ENABLE_NONFREE=1</code> enabled. You can read more about it here <a href="https://github.com/skvark/opencv-python/issues/126" class="css-o7eq5i">OpenCV #126</a>.</p><p class="css-1ek8oqb">According to the <a href="https://patents.google.com/patent/US6711293B1/en" class="css-o7eq5i">SIFT patent</a> it
is set to expire on 03/06/2020. A <a href="https://github.com/opencv/opencv/issues/16736" class="css-o7eq5i">Github issue</a>
has already been opened to move SIFT back into the main repository.</p><h2 id="fundamental-matrix" class="css-h7w91b"><a href="#fundamental-matrix" aria-label="Fundamental matrix" class="css-vvm4x1"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Fundamental matrix</h2><p class="css-1ek8oqb">The next step in our process is to calculate the fundamental matrix and determine
if the images have sufficient matches to be recognized as originating fromt the same
scene. </p><p class="css-1ek8oqb">To understand what the fundamental matrix is and why its important, we need to take a
look at epipolar geometry. </p><p class="css-1ek8oqb"><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:431px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:70.14492753623188%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsSAAALEgHS3X78AAAB80lEQVQoz4WTWXOiQBDH/fD7tC952K+Rt2yllqSylV2V4VKBAILKIZcHKPegK5BtxaQsK9nth64Z6F//u6dnOq9v1jQN+CiK0jR937b+M+tcwUmSqKqKMa7rOrvI8h/43Q6Hg2Wanu8vgkDTtDiOP0txDUNQU9ewUNDvu5svBS7/If6BMtDgRap3++2rYZqnfM1Vdx/AzVucoigkQlPD6vV6w+EQGrk8wvpU2hkuyxJOeLfbtb/H4zFCSJJeeH4kyzLDMDRNQ0xVVdvt1rKsyWTSZjnCjuPM53PXdX3fo2mKIB4Gg4EgCKIogocq+v0+QRC24wRhmCaJ53mgdFaGDUwly/MRhTRFCzchMCRJSpIEi263C8PLiyKLIlXgcblbrVZwHc4wKO/3e13XNVW118eURZ4DDDVzHMeybNuht4aPVBgGYHAdzjBM1DDMma6nSWz74TKusjShKFqSZZ4XWI7DuMD7xlzkWZbOZjpJos1me4ZZBv36+WhbuufOw5U3swNJ1hi6z49YkedIsjubaLq9dlxXnyqSOHp6/EGhXlniDjTMMw+Rxy9Mdm0PV/PBC33/9P3OnHDJQkyX0lTuW4aBiNvAGS4tDmLwRptKzyN+cFS2LDs8ldHOef+nSuD8sqxttSiw7/uHqnq9eCpRFNu28xfQBgbHJCo4DwAAAABJRU5ErkJggg==&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image css-0" alt="Epipolar geometry" title="Epipolar geometry" src="/blog/static/db10f5ac3049061dcc64ce510980ac78/9cb4e/epipolar.png" srcSet="/blog/static/db10f5ac3049061dcc64ce510980ac78/e4d6b/epipolar.png 345w,/blog/static/db10f5ac3049061dcc64ce510980ac78/9cb4e/epipolar.png 431w" sizes="(max-width: 431px) 100vw, 431px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
    </span></p><p class="css-1ek8oqb">The image above depicts a typical stereo vision scenario, where two optical
sensors(<strong class="css-0">O1</strong> and <strong class="css-0">O2</strong>) are observing an object <strong class="css-0">P</strong>, these three points together
forms the epipolar plane(grey area). The projection of <strong class="css-0">P</strong> on to each image planes
is represented as <strong class="css-0">p</strong> and <strong class="css-0">p’</strong>.</p><p class="css-1ek8oqb">The orange line connecting the two image sensors is referred to as the baseline, the
locations where the baseline intersects the two image planes are know as the
epipoles(<strong class="css-0">e</strong> and <strong class="css-0">e’</strong>), and the intersection of the epipolar plane and the two
image planes are know as the epipolar lines(blue lines).</p><p class="css-1ek8oqb">Fundamental matrix is a 3x3 homogeneous matrix that encodes information about the
camera matrices, relative translation and rotation between cameras, this allows us
to use epipolar geometry to deduce relations between images pairs without
knowing all the constraints. In other words if we know the fundamental matrix, any
point in one image allows us to calculate the epipolar line of the respective
point in the other image.</p><p class="css-1ek8oqb">Luckily for us, we do not acutally need to know the intrinsic and extrinsic camera
matrices nor the relative transformations between the cameras to calculate the
fundamental matrix. We can simply estimate the fundamental matrix with
<a href="https://en.wikipedia.org/wiki/Random_sample_consensus" class="css-o7eq5i">Random sample consensus (RANSAC)</a>.</p><h2 id="homography-estimation-and-image-stitching" class="css-h7w91b"><a href="#homography-estimation-and-image-stitching" aria-label="Homography estimation and image stitching" class="css-vvm4x1"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Homography estimation and image stitching</h2><p class="css-1ek8oqb">The final step in image stitching is finding the homography matrix. The homography matrix
in essence allows an image to be transformed from one image plane to another. </p><p class="css-1ek8oqb">To estimate the homography matrix we can again use RANSAC.
Estimating the homography matrix also serves a second purpose, if we see a
significant drop in the number of matches this would indicate that the images can
not be aligned accurately enought to form a good panoramic.</p><h2 id="code-fundamental-and-homography-matrix" class="css-h7w91b"><a href="#code-fundamental-and-homography-matrix" aria-label="CODE: Fundamental and Homography matrix" class="css-vvm4x1"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CODE: Fundamental and Homography matrix</h2><pre class="language-python prism-code language-python css-1eu4vb7"><div class="token-line"><span class="token comment"># good: matched pairs from FLANN</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># pts1: matched point from image 1</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># pts2: matched point from image 2 </span><span class="token plain"></span></div><div class="token-line"><style data-emotion-css="1baulvz">.css-1baulvz{display:inline-block;}</style><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> </span><span class="token function">homoEst</span><span class="token punctuation">(</span><span class="token plain">pts1</span><span class="token punctuation">,</span><span class="token plain"> pts2</span><span class="token punctuation">,</span><span class="token plain"> good</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    H</span><span class="token punctuation">,</span><span class="token plain"> stat </span><span class="token operator">=</span><span class="token plain"> cv2</span><span class="token punctuation">.</span><span class="token plain">findHomography</span><span class="token punctuation">(</span><span class="token plain">pts1</span><span class="token punctuation">,</span><span class="token plain"> pts2</span><span class="token punctuation">,</span><span class="token plain"> cv2</span><span class="token punctuation">.</span><span class="token plain">RANSAC</span><span class="token punctuation">,</span><span class="token plain"> ransacReprojThreshold </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token plain"> confidence </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0.99</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    h_match </span><span class="token operator">=</span><span class="token plain"> good</span><span class="token punctuation">[</span><span class="token plain">stat</span><span class="token punctuation">.</span><span class="token plain">ravel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Inliers count after Homography estimate %d&quot;</span><span class="token operator">%</span><span class="token punctuation">(</span><span class="token plain">h_match</span><span class="token punctuation">.</span><span class="token plain">shape</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> H</span><span class="token punctuation">,</span><span class="token plain"> h_match</span></div><div class="token-line"><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> </span><span class="token function">fundEst</span><span class="token punctuation">(</span><span class="token plain">pts1</span><span class="token punctuation">,</span><span class="token plain"> pts2</span><span class="token punctuation">,</span><span class="token plain"> good</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    FM</span><span class="token punctuation">,</span><span class="token plain"> mask </span><span class="token operator">=</span><span class="token plain"> cv2</span><span class="token punctuation">.</span><span class="token plain">findFundamentalMat</span><span class="token punctuation">(</span><span class="token plain">pts1</span><span class="token punctuation">,</span><span class="token plain"> pts2</span><span class="token punctuation">,</span><span class="token plain"> cv2</span><span class="token punctuation">.</span><span class="token plain">FM_RANSAC</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">0.99</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    fm_match </span><span class="token operator">=</span><span class="token plain"> good</span><span class="token punctuation">[</span><span class="token plain">mask</span><span class="token punctuation">.</span><span class="token plain">ravel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Inliers count after Fundamental estimate: %d&quot;</span><span class="token operator">%</span><span class="token punctuation">(</span><span class="token plain">fm_match</span><span class="token punctuation">.</span><span class="token plain">shape</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> FM</span><span class="token punctuation">,</span><span class="token plain"> fm_match</span></div></pre><h2 id="image-stitching" class="css-h7w91b"><a href="#image-stitching" aria-label="Image stitching" class="css-vvm4x1"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Image stitching</h2><p class="css-1ek8oqb">If we retain sufficent keypoint pairs after running through Homography estimation
and Fundamental matrix estimation, we can then begin image stitching.</p><p class="css-1ek8oqb">First step in the process is to determine an anchor image which will remain fixed,
while the second image will be warped and mapped to the perspective of the anchor
image.</p><p class="css-1ek8oqb">To do this we can calculate the norm of the homography matrix. Note that norm-2 takes
the inverse of the homography matrix this is due to the original homography matrix
being calculated from image 1 mapped to image 2.</p><pre class="language-python prism-code language-python css-1eu4vb7"><div class="token-line"><span class="token plain">norm1 </span><span class="token operator">=</span><span class="token plain"> np</span><span class="token punctuation">.</span><span class="token plain">sqrt</span><span class="token punctuation">(</span><span class="token plain">H</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">**</span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> H</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">norm2 </span><span class="token operator">=</span><span class="token plain"> np</span><span class="token punctuation">.</span><span class="token plain">sqrt</span><span class="token punctuation">(</span><span class="token plain">np</span><span class="token punctuation">.</span><span class="token plain">linalg</span><span class="token punctuation">.</span><span class="token plain">inv</span><span class="token punctuation">(</span><span class="token plain">H</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">**</span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> np</span><span class="token punctuation">.</span><span class="token plain">linalg</span><span class="token punctuation">.</span><span class="token plain">inv</span><span class="token punctuation">(</span><span class="token plain">H</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span></div></pre><p class="css-1ek8oqb">If norm-1 is larger than norm-2 we warp image 1 to image 2, if on the other hand
norm-2 is larger than norm-1 we warp image 2 to image 1.</p><p class="css-1ek8oqb">Once the anchor image has been determined we can calculate a translation matrix for
the second image by using the homography matrix to remap the image corners.</p><pre class="language-python prism-code language-python css-1eu4vb7"><div class="token-line"><span class="token comment">#remap corners to new frame</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> </span><span class="token function">remap</span><span class="token punctuation">(</span><span class="token plain">x</span><span class="token punctuation">,</span><span class="token plain">y</span><span class="token punctuation">,</span><span class="token plain">z</span><span class="token punctuation">,</span><span class="token plain">w</span><span class="token punctuation">,</span><span class="token plain">H</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    x_dot </span><span class="token operator">=</span><span class="token plain"> np</span><span class="token punctuation">.</span><span class="token plain">dot</span><span class="token punctuation">(</span><span class="token plain">H</span><span class="token punctuation">,</span><span class="token plain">x</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    y_dot </span><span class="token operator">=</span><span class="token plain"> np</span><span class="token punctuation">.</span><span class="token plain">dot</span><span class="token punctuation">(</span><span class="token plain">H</span><span class="token punctuation">,</span><span class="token plain">y</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    z_dot </span><span class="token operator">=</span><span class="token plain"> np</span><span class="token punctuation">.</span><span class="token plain">dot</span><span class="token punctuation">(</span><span class="token plain">H</span><span class="token punctuation">,</span><span class="token plain">z</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    w_dot </span><span class="token operator">=</span><span class="token plain"> np</span><span class="token punctuation">.</span><span class="token plain">dot</span><span class="token punctuation">(</span><span class="token plain">H</span><span class="token punctuation">,</span><span class="token plain">w</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> x_dot</span><span class="token operator">/</span><span class="token plain">x_dot</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> y_dot</span><span class="token operator">/</span><span class="token plain">y_dot</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> z_dot</span><span class="token operator">/</span><span class="token plain">z_dot</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> w_dot</span><span class="token operator">/</span><span class="token plain">w_dot</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">#calculates the translation offset base on the corners</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">#returns a compsite matrix</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> </span><span class="token function">calcTranslation</span><span class="token punctuation">(</span><span class="token plain">img1</span><span class="token punctuation">,</span><span class="token plain"> img2</span><span class="token punctuation">,</span><span class="token plain"> H</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    C1</span><span class="token punctuation">,</span><span class="token plain">C2</span><span class="token punctuation">,</span><span class="token plain">C3</span><span class="token punctuation">,</span><span class="token plain">C4 </span><span class="token operator">=</span><span class="token plain"> remap</span><span class="token punctuation">(</span><span class="token plain">np</span><span class="token punctuation">.</span><span class="token plain">array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain">np</span><span class="token punctuation">.</span><span class="token plain">array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token plain">img1</span><span class="token punctuation">.</span><span class="token plain">shape</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain">img1</span><span class="token punctuation">.</span><span class="token plain">shape</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain">np</span><span class="token punctuation">.</span><span class="token plain">array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain">img1</span><span class="token punctuation">.</span><span class="token plain">shape</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain">np</span><span class="token punctuation">.</span><span class="token plain">array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token plain">img1</span><span class="token punctuation">.</span><span class="token plain">shape</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain">H</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    minX </span><span class="token operator">=</span><span class="token plain"> </span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token plain">C1</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain">C2</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain">C3</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain">C4</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    minY </span><span class="token operator">=</span><span class="token plain"> </span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token plain">C1</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain">C2</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain">C3</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain">C4</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    osX </span><span class="token operator">=</span><span class="token plain"> </span><span class="token builtin">abs</span><span class="token punctuation">(</span><span class="token plain">minX</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">if</span><span class="token plain"> minX </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token keyword">else</span><span class="token plain">  </span><span class="token number">0</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    osY </span><span class="token operator">=</span><span class="token plain"> </span><span class="token builtin">abs</span><span class="token punctuation">(</span><span class="token plain">minY</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">if</span><span class="token plain"> minY </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token keyword">else</span><span class="token plain">  </span><span class="token number">0</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    matrix </span><span class="token operator">=</span><span class="token plain"> np</span><span class="token punctuation">.</span><span class="token plain">array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain">osX</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain">osY</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    composite </span><span class="token operator">=</span><span class="token plain"> np</span><span class="token punctuation">.</span><span class="token plain">dot</span><span class="token punctuation">(</span><span class="token plain">matrix</span><span class="token punctuation">,</span><span class="token plain"> H</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> composite</span><span class="token punctuation">,</span><span class="token plain"> osX</span><span class="token punctuation">,</span><span class="token plain"> osY</span></div></pre><p class="css-1ek8oqb">Next to integrate both images together we need to calculate the new coordinates for both image 1 and image 2.</p><pre class="language-python prism-code language-python css-1eu4vb7"><div class="token-line"><span class="token keyword">def</span><span class="token plain"> </span><span class="token function">warp</span><span class="token punctuation">(</span><span class="token plain">composite</span><span class="token punctuation">,</span><span class="token plain"> osx</span><span class="token punctuation">,</span><span class="token plain"> osy</span><span class="token punctuation">,</span><span class="token plain"> img1</span><span class="token punctuation">,</span><span class="token plain"> img2</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">#calculate new coordinates for image1 and image 2</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    img1_c1</span><span class="token punctuation">,</span><span class="token plain"> img1_c2</span><span class="token punctuation">,</span><span class="token plain"> img1_c3</span><span class="token punctuation">,</span><span class="token plain"> img1_c4 </span><span class="token operator">=</span><span class="token plain"> \</span></div><div class="token-line"><span class="token plain">        remap</span><span class="token punctuation">(</span><span class="token plain">np</span><span class="token punctuation">.</span><span class="token plain">array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain">np</span><span class="token punctuation">.</span><span class="token plain">array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token plain">img1</span><span class="token punctuation">.</span><span class="token plain">shape</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain">img1</span><span class="token punctuation">.</span><span class="token plain">shape</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain">np</span><span class="token punctuation">.</span><span class="token plain">array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain">img1</span><span class="token punctuation">.</span><span class="token plain">shape</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain">np</span><span class="token punctuation">.</span><span class="token plain">array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token plain">img1</span><span class="token punctuation">.</span><span class="token plain">shape</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token plain"> </span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain">composite</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    img2_c1 </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">osx</span><span class="token punctuation">,</span><span class="token plain"> osy</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    img2_c2 </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">osx </span><span class="token operator">+</span><span class="token plain"> img2</span><span class="token punctuation">.</span><span class="token plain">shape</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> osy </span><span class="token operator">+</span><span class="token plain"> img2</span><span class="token punctuation">.</span><span class="token plain">shape</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    img2_c3 </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">osx</span><span class="token punctuation">,</span><span class="token plain"> osy </span><span class="token operator">+</span><span class="token plain"> img2</span><span class="token punctuation">.</span><span class="token plain">shape</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    img2_c4 </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">osx</span><span class="token operator">+</span><span class="token plain">img2</span><span class="token punctuation">.</span><span class="token plain">shape</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> osy</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">#calculate size of new image</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    col </span><span class="token operator">=</span><span class="token plain"> </span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token plain">img1_c1</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> img1_c2</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> img1_c3</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> img1_c4</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain">\</span></div><div class="token-line"><span class="token plain">            img2_c1</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> img2_c2</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> img2_c3</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> img2_c4</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"> </span></div><div class="token-line"><span class="token plain">    row </span><span class="token operator">=</span><span class="token plain"> </span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token plain">img1_c1</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> img1_c2</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> img1_c3</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> img1_c4</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain">\</span></div><div class="token-line"><span class="token plain">            img2_c1</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> img2_c2</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> img2_c3</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> img2_c4</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">#print image size</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    r1 </span><span class="token operator">=</span><span class="token plain"> cv2</span><span class="token punctuation">.</span><span class="token plain">warpPerspective</span><span class="token punctuation">(</span><span class="token plain">img1</span><span class="token punctuation">,</span><span class="token plain"> composite</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token plain">col</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token plain">row</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> flags </span><span class="token operator">=</span><span class="token plain"> cv2</span><span class="token punctuation">.</span><span class="token plain">INTER_LINEAR</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    r2 </span><span class="token operator">=</span><span class="token plain"> np</span><span class="token punctuation">.</span><span class="token plain">zeros</span><span class="token punctuation">(</span><span class="token plain">r1</span><span class="token punctuation">.</span><span class="token plain">shape</span><span class="token punctuation">,</span><span class="token plain"> dtype </span><span class="token operator">=</span><span class="token plain"> r1</span><span class="token punctuation">.</span><span class="token plain">dtype</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    r2</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token plain">osy</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token plain">img2</span><span class="token punctuation">.</span><span class="token plain">shape</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token plain">osy</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token plain">osx</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token plain">img2</span><span class="token punctuation">.</span><span class="token plain">shape</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token plain">osx</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> img2</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> r1</span><span class="token punctuation">,</span><span class="token plain"> r2</span></div></pre><h3 id="image-blending" class="css-h7w91b"><a href="#image-blending" aria-label="Image blending" class="css-vvm4x1"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Image blending</h3><p class="css-1ek8oqb">At this step we have the final canvas size of the panoramic and two images with its
coordinates remapped/wrapped. For regions that are not overlapping we can copy
directly from source image to the final canvas. For regions that are overlapping we
can create a mask with its weight split 20/80.</p><pre class="language-python prism-code language-python css-1eu4vb7"><div class="token-line"><span class="token plain">stitch </span><span class="token operator">=</span><span class="token plain"> img1_canvas </span><span class="token operator">+</span><span class="token plain"> img2_canvas</span></div><div class="token-line"><span class="token plain">overlap1 </span><span class="token operator">=</span><span class="token plain"> np</span><span class="token punctuation">.</span><span class="token plain">copy</span><span class="token punctuation">(</span><span class="token plain">img1_canvas</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">overlap2 </span><span class="token operator">=</span><span class="token plain"> np</span><span class="token punctuation">.</span><span class="token plain">copy</span><span class="token punctuation">(</span><span class="token plain">img2_canvas</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">overlap1</span><span class="token punctuation">[</span><span class="token plain">np</span><span class="token punctuation">.</span><span class="token plain">where</span><span class="token punctuation">(</span><span class="token plain">stitch </span><span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0.20</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">overlap2</span><span class="token punctuation">[</span><span class="token plain">np</span><span class="token punctuation">.</span><span class="token plain">where</span><span class="token punctuation">(</span><span class="token plain">stitch </span><span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0.80</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">fin_stitch </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">r1</span><span class="token operator">*</span><span class="token plain">overlap1</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">r2</span><span class="token operator">*</span><span class="token plain">overlap2</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">fin_stitch </span><span class="token operator">=</span><span class="token plain"> cv2</span><span class="token punctuation">.</span><span class="token plain">GaussianBlur</span><span class="token punctuation">(</span><span class="token plain">fin_stitch</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">cv2</span><span class="token punctuation">.</span><span class="token plain">imwrite</span><span class="token punctuation">(</span><span class="token plain">img_out</span><span class="token punctuation">,</span><span class="token plain"> fin_stitch</span><span class="token punctuation">)</span></div></pre><h2 id="results" class="css-h7w91b"><a href="#results" aria-label="Results" class="css-vvm4x1"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Results</h2><p class="css-1ek8oqb">Below are the two images that we wish to stitch together</p><p class="css-1ek8oqb"><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1017px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:40.869565217391305%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAAB80lEQVQY0wHoARf+ANHY4L7EzKmts5icoGprbHFydJudor3GzdvS2dPCydXk7Nri68fO1qessJOWmZSXm6+0udLa4dzl7tDY4QDJ0Nmwt76HiY2Jioxyc3Nubm+MjpKkrbXc1dvOvcXM2uPHztersLeKjI90dnaBg4Scn6K0usDV3ubU3uUAxc3Ut77EkJOVaWlobm5th4mJh4mMsLrBz8jPybjBv8zVs7i/oaSohIaIYmNkaWprgIOEoaWqwcjPz9jgAMDJ0bvDy5qeoVxcWk5LSGVjYKWprqSss7uzucGwt7G8xZaZnoCDhYOFhW9xcVZWVX+ChIOGiaarss3V3QCgpq2ChYhTTktEQT04My5DPTdua2peX11oVlS6qK6tucCYm6BzdXVaWVhmZmVtb2+ChIZ7fYGnrrW6wsoAPjg1LCYiMi0qODMvPjgyR0A6QTo2RURBWUdHr52koKy0o6ivdXh5TExKRURDUVFPdHZ2nKGnjpKZoqiuAF5XRVpVQ1dSQlRQQ05LQF5aUFhTTE1NRVxLRZ+MlI6aoWhpa0dEQzo4Ny8sKi8rKE1LSmlqbFhYWFJSUQBVTz1QSzVPSjVRTThJRTRLSDZQTTlMTTheSThUODcvMC8qJCIrJyYvLCo0MC00MjA5NDE6NjQ8OTZAPjsnIvCxA6XqsAAAAABJRU5ErkJggg==&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image css-0" alt="original images" title="original images" src="/blog/static/f357846c31f722084a23b86a8e3f4f44/44a54/image2-image3.png" srcSet="/blog/static/f357846c31f722084a23b86a8e3f4f44/e4d6b/image2-image3.png 345w,/blog/static/f357846c31f722084a23b86a8e3f4f44/1e043/image2-image3.png 690w,/blog/static/f357846c31f722084a23b86a8e3f4f44/44a54/image2-image3.png 1017w" sizes="(max-width: 1017px) 100vw, 1017px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
    </span></p><p class="css-1ek8oqb">Here are the keypoints detected after the inital FLANN matching</p><p class="css-1ek8oqb"><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1380px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:37.391304347826086%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIB/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAZkTQv8A/8QAFxABAQEBAAAAAAAAAAAAAAAAAgEAA//aAAgBAQABBQJdYlXp3R3/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAWEAADAAAAAAAAAAAAAAAAAAAAECH/2gAIAQEABj8CUP/EABYQAQEBAAAAAAAAAAAAAAAAAAERAP/aAAgBAQABPyGsFTAYCTN//9oADAMBAAIAAwAAABAED//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAEDAQE/EGf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAaEAACAgMAAAAAAAAAAAAAAAAAEQEhQVGR/9oACAEBAAE/ENZMlJGe6xZ73cSf/9k=&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image css-0" alt="FLANN matching" title="FLANN matching" src="/blog/static/b98a068119427ba2f9f1ec2e1fec69ba/89b2d/image2_image3_match_init.jpg" srcSet="/blog/static/b98a068119427ba2f9f1ec2e1fec69ba/8d48c/image2_image3_match_init.jpg 345w,/blog/static/b98a068119427ba2f9f1ec2e1fec69ba/15ec7/image2_image3_match_init.jpg 690w,/blog/static/b98a068119427ba2f9f1ec2e1fec69ba/89b2d/image2_image3_match_init.jpg 1380w,/blog/static/b98a068119427ba2f9f1ec2e1fec69ba/3acf0/image2_image3_match_init.jpg 2000w" sizes="(max-width: 1380px) 100vw, 1380px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
    </span></p><p class="css-1ek8oqb">Inlier keypoints after Fundamental matrix estimation</p><p class="css-1ek8oqb"><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1380px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:37.391304347826086%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAL/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAABiRKC/wD/xAAXEAEBAQEAAAAAAAAAAAAAAAACAQAD/9oACAEBAAEFAl2iVendHf/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABcQAAMBAAAAAAAAAAAAAAAAAAAQESH/2gAIAQEABj8CWQ//xAAYEAEBAQEBAAAAAAAAAAAAAAABABEhQf/aAAgBAQABPyHlVSPyOwYv/9oADAMBAAIAAwAAABCHz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABsQAQACAgMAAAAAAAAAAAAAAAEAQREhMVGB/9oACAEBAAE/EBDRHjEBT0Z2HGxn/9k=&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image css-0" alt="Fundamental matrix estimation" title="Fundamental matrix estimation" src="/blog/static/4903e17e851d6b8f2762c70fa3bf2f6c/89b2d/image2_image3_match_fund.jpg" srcSet="/blog/static/4903e17e851d6b8f2762c70fa3bf2f6c/8d48c/image2_image3_match_fund.jpg 345w,/blog/static/4903e17e851d6b8f2762c70fa3bf2f6c/15ec7/image2_image3_match_fund.jpg 690w,/blog/static/4903e17e851d6b8f2762c70fa3bf2f6c/89b2d/image2_image3_match_fund.jpg 1380w,/blog/static/4903e17e851d6b8f2762c70fa3bf2f6c/3acf0/image2_image3_match_fund.jpg 2000w" sizes="(max-width: 1380px) 100vw, 1380px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
    </span></p><p class="css-1ek8oqb">Remaining keypoints after homography estimation</p><p class="css-1ek8oqb"><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1380px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:37.391304347826086%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECA//EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAc4CwP/EABgQAAMBAQAAAAAAAAAAAAAAAAECAwAR/9oACAEBAAEFAnuC7V7hdgP/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAXEAADAQAAAAAAAAAAAAAAAAAAECER/9oACAEBAAY/Aoph/8QAGRABAQADAQAAAAAAAAAAAAAAAQARIUHh/9oACAEBAAE/IQSlDs3uxbRf/9oADAMBAAIAAwAAABBwD//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABgQAAMBAQAAAAAAAAAAAAAAAAERIQBR/9oACAEBAAE/EORiiWqCjpF5a6Og7//Z&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image css-0" alt="Homography matrix" title="Homography matrix" src="/blog/static/67609190719917e538130c580c130ae5/89b2d/image2_image3_match_homo.jpg" srcSet="/blog/static/67609190719917e538130c580c130ae5/8d48c/image2_image3_match_homo.jpg 345w,/blog/static/67609190719917e538130c580c130ae5/15ec7/image2_image3_match_homo.jpg 690w,/blog/static/67609190719917e538130c580c130ae5/89b2d/image2_image3_match_homo.jpg 1380w,/blog/static/67609190719917e538130c580c130ae5/3acf0/image2_image3_match_homo.jpg 2000w" sizes="(max-width: 1380px) 100vw, 1380px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
    </span></p><p class="css-1ek8oqb">Finally here are the two images stitched together along with the output log</p><p class="css-1ek8oqb"><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1138px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:89.56521739130436%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAASABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAQCBQH/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAG2WXJ0HFHuwlB//8QAHBAAAgICAwAAAAAAAAAAAAAAAQIAAyMyBBIi/9oACAEBAAEFAu+NT6utVGF2FHInIcu6ay3b/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAGxABAAEFAQAAAAAAAAAAAAAAAQACEBExURL/2gAIAQEABj8CHpYMGpTT5dTUF5C//8QAGxAAAgMAAwAAAAAAAAAAAAAAAREAITEQUXH/2gAIAQEAAT8h6agy+wKmiNshyARI4XZYQJGJy8PJ/9oADAMBAAIAAwAAABDgDzz/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EB//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/EB//xAAgEAEAAgIBBAMAAAAAAAAAAAABACERUTFBYXGRobHR/9oACAEBAAE/EEKHLKJsJhLzQJHZR3O012jWQW+KMVEvDqThxUNAI0Xb+z4E6sXq/bP/2Q==&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image css-0" alt="Final image" title="Final image" src="/blog/static/10dfad393c04c26c2c3023d1feb2a19b/e8a7f/image2_image3.jpg" srcSet="/blog/static/10dfad393c04c26c2c3023d1feb2a19b/8d48c/image2_image3.jpg 345w,/blog/static/10dfad393c04c26c2c3023d1feb2a19b/15ec7/image2_image3.jpg 690w,/blog/static/10dfad393c04c26c2c3023d1feb2a19b/e8a7f/image2_image3.jpg 1138w" sizes="(max-width: 1138px) 100vw, 1138px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
    </span></p><pre class="prism-code language-css-1q7q4hh css-1eu4vb7"><div class="token-line"><span class="token plain">Comparing image2.JPG and image3.JPG</span></div><div class="token-line"><span class="token plain">Matches found: 1287</span></div><div class="token-line"><span class="token plain">Inliers count after Fundamental estimate: 966</span></div><div class="token-line"><span class="token plain">Fundamental decision ---</span></div><div class="token-line"><span class="token plain">Matched scene: inlier threshold meet</span></div><div class="token-line"><span class="token plain">Inliers count after Homography estimate 397</span></div><div class="token-line"><span class="token plain">Homography decision ---</span></div><div class="token-line"><span class="token plain">image2_image3 Possible for alignment</span></div><div class="token-line"><span class="token plain">Alignment possible: combine images</span></div><div class="token-line"><span class="token plain">Warp Image 1 -&gt; Image 2</span></div></pre></section></article></main><style data-emotion-css="1i8tjli">.css-1i8tjli{margin-top:32px;padding-top:16px;}</style><footer class="css-1i8tjli"><style data-emotion-css="1u77lb1">.css-1u77lb1{border-color:var(--theme-ui-colors-muted,hsla(0,0%,0%,0.2));}</style><hr class="css-1u77lb1"/><style data-emotion-css="j6r63x">.css-j6r63x{margin-bottom:32px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><style data-emotion-css="u5xevn">.css-u5xevn{box-sizing:border-box;margin:0;min-width:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-bottom:32px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><div class="css-u5xevn"><style data-emotion-css="1emx3y6">.css-1emx3y6{margin-right:8px;margin-bottom:0;width:48px;min-width:48px;border-radius:99999px;}</style><div class="css-1emx3y6 gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:48px;height:48px"><img aria-hidden="true" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAPoAAAD6AG1e1JrAAADfklEQVQ4yy2UaSusYRjH7/eSMJYwCTH2MAzZ9/XYZixjOQzJvpdtwsjY910TJURSyL5FSZIir7zyEXyJ8/PMuV9Mz/14/td/ua6L+Cud8vLy6urq2trapqYmnrOzs/Pz89va2jIyMuLj47mmpKQkJycnJCREREQ4OTnZ2dkFBweLmpoavktPT29ubq6vr8/KyvLx8XF0dLSxsfH19QUJng94n5aWlpSUxJvIyEiVSsVVVFZWajSavLy8np6ewsJCLy8vMB4eHpS3tramRGpqanFx8R/pAEhMTIyLi0NISUmJaGlpQXBFRcXAwAD3qKgopVIJ3s3NzdnZ2dLSMigoqKysLCcnJzc3NzMzk1rgscBLsbS0NDU1NTY2NjExgYWioqLBwUGqQII8+ClEaY10MI9B8HjR6XRia2trZWVlZmZmcnKyvb2d5+XlZfw3NDSo1Wo/Pz9KIK1AOrhDPPxarRYmsb+/v7Gxsbi4CBj+09PT2dlZTIJEHpFCUlVVxdeIMoPh5+E3sJOTk52dnbW1Ncinp6ff3t4Aw2w2iTdz4NQCgGaioigNi46OFufn53t7eyaTCXKYPz4+Njc3x8fHsU3/KR8aGopyEo6JiaFDJEqE3t7e4eHh4uzsDPD6+vr8/Pzo6Ci1Xl9f9Xo9bSstLYWE8FXSgQrCsLAwvLi4uNja2oqbmxtsb29vHx4ezs3NdXV1vb+/84BtUuW7wMBA2ubv7w+YK7TgFQqFhYWF+Pr6ur+/Pzg4eHp66u7uJpW+vj661djYiGF3d3eUkxAiAwICGCEEYwSwlZWVeH5+vry8NIunJUwoozY8PEzbsBcbGzs0NMQIUA4X9DwkJAQhcrlcJpOJ29vbi4uLu7s7g8EAuKOjgz6TPIT4xDzXhYWFkZGRzs5O+sRLV1dXBwcHe3v737Svrq6ur69pD/H29vaChB9tKF9dXQXM5FAactYOvKen53/w0dERmSGbPzAMaK6rqyNkhhEMnHSRFhIk5PzSQmwjm80Tx8fHDw8PjAoDDDP7bN5ho9EIkoHhF8Fkyeagizkhc9aWsRfM48vLCyUoyXqCZxiYW7aF2IzSgZAR2N3d7e/vJ3nigJxGCJpE4I+Pj6TFevLfgw5jTy8drsw8zJRGEXYorZAOePH9/f3z88MX2P78/EQkTaKKTjqtra3m9aJnDAlLRtRw4hn8Py2SxJ4Rl0RGAAAAAElFTkSuQmCC" alt="David S. Wang" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source srcset="/blog/static/d2552faa6c8cdf254e63b599f6636099/aff39/avatar.png 1x,
/blog/static/d2552faa6c8cdf254e63b599f6636099/e5b88/avatar.png 1.5x,
/blog/static/d2552faa6c8cdf254e63b599f6636099/88b72/avatar.png 2x" /><img loading="lazy" width="48" height="48" srcset="/blog/static/d2552faa6c8cdf254e63b599f6636099/aff39/avatar.png 1x,
/blog/static/d2552faa6c8cdf254e63b599f6636099/e5b88/avatar.png 1.5x,
/blog/static/d2552faa6c8cdf254e63b599f6636099/88b72/avatar.png 2x" src="/blog/static/d2552faa6c8cdf254e63b599f6636099/aff39/avatar.png" alt="David S. Wang" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><div class="css-0">Hi, my name is David.<br/>This is my blog where I write about my projects and things that interest me.</div></div><style data-emotion-css="11r1i3o">.css-11r1i3o{-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;list-style:none;padding:0;}</style><style data-emotion-css="15qbtrw">.css-15qbtrw{box-sizing:border-box;margin:0;min-width:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;list-style:none;padding:0;}</style><ul class="css-15qbtrw"><li><a rel="prev" class="css-o7eq5i" href="/blog/seam-carving/">← <!-- -->Content aware image resizing (seam carving)</a></li><li></li></ul></footer></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/image-stitching/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-b3cdf4efa4860a9f5b07.js"],"app":["/app-37cb779e3823baa1247d.js"],"component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js":["/component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js-8c8b83fd421af225f5d7.js"],"component---node-modules-gatsby-theme-blog-core-src-templates-posts-query-js":["/component---node-modules-gatsby-theme-blog-core-src-templates-posts-query-js-6dba34c92f0c4e81a7bb.js"]};/*]]>*/</script><script src="/blog/polyfill-b3cdf4efa4860a9f5b07.js" nomodule=""></script><script src="/blog/component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js-8c8b83fd421af225f5d7.js" async=""></script><script src="/blog/commons-d5ea4e68f42cb2f584b0.js" async=""></script><script src="/blog/777cf710-b8339dbac930299739e2.js" async=""></script><script src="/blog/styles-e9d24b1846c7d6eb9685.js" async=""></script><script src="/blog/app-37cb779e3823baa1247d.js" async=""></script><script src="/blog/framework-dbb498007a7447f28d8e.js" async=""></script><script src="/blog/webpack-runtime-65d049c7e0bfd164af7a.js" async=""></script></body></html>